<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gest√£oApp - Sistema Web</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="tela-login" class="login-container">
      <div class="login-box">
        <h2>Gest√£oApp</h2>
        <p>Acesso ao Sistema</p>
        <div class="input-group">
          <span class="material-icons">person</span>
          <input type="text" id="usuario" placeholder="Usu√°rio">
        </div>
        <div class="input-group">
          <span class="material-icons">lock</span>
          <input type="password" id="senha" placeholder="Senha">
        </div>
        <button id="btnLogin">ENTRAR</button>
        <div id="msg-erro" class="error-msg"></div>
      </div>
    </div>

    <div id="tela-dashboard" class="dashboard-container" style="display: none;">
      
      <aside class="sidebar">
        <div class="logo-area">
          <h3>Gest√£o<span>App</span></h3>
        </div>
        <nav>
          <ul>
            <li data-route="produtos">
              <span class="material-icons">inventory_2</span> Meus Produtos
            </li>
            <li data-route="notas_entrada">
              <span class="material-icons">receipt_long</span> Notas de Entrada
            </li>
            <li data-route="financeiro">
              <span class="material-icons">attach_money</span> Financeiro
            </li>
            <li data-route="relatorios">
              <span class="material-icons">assessment</span> Relat√≥rio
            </li>
            <li data-route="usuarios">
              <span class="material-icons">group</span> Usu√°rios
            </li>
            <li data-route="configuracoes" style="margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
              <span class="material-icons">settings</span> Configura√ß√µes
            </li>
          </ul>
        </nav>
        <div class="logout-area" id="btnSair">
          <span class="material-icons">logout</span> Sair
        </div>
      </aside>

      <main class="main-content">
        <header>
          <h2 id="titulo-secao">Dashboard</h2>
          <div class="user-info" id="btnPerfil" title="Clique para editar seu perfil" style="cursor: pointer;">
            <span id="display-nome-usuario">Usu√°rio</span>
            <span class="material-icons">account_circle</span>
          </div>
        </header>

        <div id="conteudo-dinamico" class="content-box">
          
          <div id="view-padrao"><p>Bem-vindo ao sistema.</p></div>

          <div id="view-produtos" style="display:none;" class="anime-left">
            <div class="toolbar">
              <div class="filters">
                <input type="text" id="barra-pesquisa" placeholder="üîç Pesquisar...">
                <select id="filtro-grupo">
                  <option value="">Todos os Grupos</option>
                </select>
              </div>
              
              <div style="display: flex; gap: 8px;">
                 <button class="btn-action" style="background-color: #34495e;" id="btnPDFProdutos">
                    <span class="material-icons">picture_as_pdf</span> PDF
                 </button>
                 <button class="btn-action" style="background-color: #f39c12;" id="btnAbrirContagem">
                    <span class="material-icons">playlist_add_check</span> Contagem
                 </button>
                 <button class="btn-action" id="btnAbrirNovoProduto">
                    <span class="material-icons">add</span> Novo Produto
                 </button>
              </div>
            </div>
            
            <div class="summary-stats" style="margin-bottom: 15px; display: inline-flex;">
                <div class="stat-item"><span>Qtd Estoque:</span><strong id="resumo-qtd">0</strong></div>
                <div class="stat-divider"></div>
                <div class="stat-item"><span>Total:</span><strong id="resumo-valor" style="color: #27ae60;">R$ 0,00</strong></div>
            </div>

            <div class="table-container">
              <table class="styled-table">
                <thead><tr><th>C√≥d.</th><th>Produto</th><th>Grupo</th><th>Qtd</th><th>Pre√ßo</th><th>A√ß√µes</th></tr></thead>
                <tbody id="tabela-produtos-corpo"></tbody>
              </table>
            </div>
          </div>

          <div id="view-notas-entrada" style="display:none;" class="anime-left">
            <div class="toolbar" style="justify-content: flex-end; gap: 15px;">
              <button class="btn-action btn-red" id="btnLancarNotaManual">
                <span class="material-icons">edit_note</span> Lan√ßar Nota
              </button>
              <button class="btn-action btn-yellow" id="btnImportarXML">
                <span class="material-icons">file_upload</span> Importar XML
              </button>
            </div>
            <div class="table-container">
              <table class="styled-table">
                <thead>
                  <tr><th>Data</th><th>N¬∫ Nota</th><th>Fornecedor</th><th>Itens</th><th>Valor Total</th><th>Tipo</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody id="tabela-notas-corpo"></tbody>
              </table>
            </div>
          </div>
          
          <div id="view-financeiro" style="display:none;" class="anime-left">
             <div class="row" style="margin-bottom:20px; gap:20px;">
                <div style="flex:1; background:white; padding:15px; border-radius:8px; border-left:4px solid #27ae60; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                  <span style="font-size:12px; color:#777;">RECEITAS</span>
                  <div id="fin-total-receitas" style="font-size:20px; font-weight:bold; color:#27ae60;">R$ 0,00</div>
                </div>
                <div style="flex:1; background:white; padding:15px; border-radius:8px; border-left:4px solid #e74c3c; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                  <span style="font-size:12px; color:#777;">DESPESAS</span>
                  <div id="fin-total-despesas" style="font-size:20px; font-weight:bold; color:#e74c3c;">R$ 0,00</div>
                </div>
                <div style="flex:1; background:white; padding:15px; border-radius:8px; border-left:4px solid #f39c12; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                  <span style="font-size:12px; color:#777;">SALDO</span>
                  <div id="fin-saldo" style="font-size:20px; font-weight:bold; color:#333;">R$ 0,00</div>
                </div>
             </div>

             <div class="toolbar" style="justify-content: space-between;">
                <div class="filters" style="max-width: 300px;">
                   <input type="text" id="barra-pesquisa-financeiro" placeholder="üîç Buscar no hist√≥rico...">
                </div>
                <div style="display: flex; gap: 10px;">
                   <button class="btn-action" style="background-color: #34495e;" id="btnPDFFinanceiro">
                      <span class="material-icons">picture_as_pdf</span> Gerar PDF
                   </button>
                   <button class="btn-action" id="btnNovaDespesa">
                     <span class="material-icons">add_circle</span> Nova Movimenta√ß√£o
                   </button>
                </div>
             </div>
             
             <div class="table-container">
               <table class="styled-table">
                 <thead>
                   <tr><th>Vencimento</th><th>Descri√ß√£o / Fornecedor</th><th>Tipo</th><th>Valor</th><th>Status</th><th>A√ß√µes</th></tr>
                 </thead>
                 <tbody id="tabela-financeiro-corpo"></tbody>
               </table>
             </div>
          </div>

          <div id="view-usuarios" style="display:none;" class="anime-left">
            <div class="toolbar" style="justify-content: flex-end;">
              <button class="btn-action" id="btnNovoUsuario">
                <span class="material-icons">add</span> Novo Usu√°rio
              </button>
            </div>
            <div class="table-container">
              <table class="styled-table">
                <thead><tr><th>Nome</th><th>Usu√°rio</th><th>Perfil</th><th>A√ß√µes</th></tr></thead>
                <tbody id="tabela-usuarios-corpo"></tbody>
              </table>
            </div>
          </div>
          
          <div id="view-configuracoes" style="display:none;" class="anime-left">
            <h3>Gerenciar Grupos</h3>
            <div class="card-config" style="margin-top:20px;">
               <div style="display:flex; gap:10px; margin-bottom:20px;">
                 <input type="text" id="novo-grupo-nome" placeholder="Nome do novo grupo" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:5px;">
                 <button class="btn-action" id="btnAddGrupo" style="width:auto;">Adicionar</button>
               </div>
               <table class="styled-table">
                 <thead><tr><th>Nome do Grupo</th><th width="50px">A√ß√£o</th></tr></thead>
                 <tbody id="tabela-config-grupos"></tbody>
               </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <div id="modal-perfil" class="modal">
      <div class="modal-content">
        <span class="close" id="closePerfil">&times;</span>
        <h3>Meu Perfil</h3>
        <form id="form-perfil">
          <div class="form-group"><label>Meu Nome</label><input type="text" id="perfil_nome" required></div>
          <div class="form-group"><label>Usu√°rio (Login)</label><input type="text" id="perfil_usuario" required></div>
          <div class="form-group"><label>Nova Senha</label><input type="text" id="perfil_senha" required></div>
          <button type="submit" class="btn-save" id="btn-salvar-perfil">Atualizar Meus Dados</button>
        </form>
      </div>
    </div>
    
    <div id="modal-nota-manual" class="modal">
      <div class="modal-content" style="width: 700px; max-width: 95%;">
        <span class="close" id="closeNotaManual">&times;</span>
        <h3 id="titulo-modal-nota">Lan√ßamento Manual de Nota</h3>
        
        <form id="form-nota-manual">
          <input type="hidden" id="nota_is_edit" value="false">
          <input type="hidden" id="nota_id_edicao" value="">
          
          <div style="background:#f9f9f9; padding:15px; border-radius:5px; margin-bottom:15px; border:1px solid #eee;">
            <h4 style="margin-bottom:10px; font-size:14px; color:#555;">Dados da Nota</h4>
            <div class="row">
               <div class="form-group half"><label>N√∫mero da Nota</label><input type="text" id="nota_numero" required></div>
               <div class="form-group half"><label>Data Emiss√£o</label><input type="date" id="nota_data" required></div>
            </div>
            <div class="form-group"><label>Fornecedor</label><input type="text" id="nota_fornecedor" required></div>
          </div>

          <div id="area-adicionar-itens" style="background:#e3f2fd; padding:15px; border-radius:5px; margin-bottom:15px; border:1px solid #bbdefb;">
            <h4 style="margin-bottom:10px; font-size:14px; color:#1976d2;">Adicionar Produto na Nota</h4>
            
            <div class="row" style="position:relative;">
              <div style="flex: 2; position:relative; display:flex; gap:5px;">
                <div style="flex:1; position:relative;">
                    <label style="font-size:12px;">Produto</label>
                    <input type="text" id="input-item-busca" placeholder="Digite para buscar..." autocomplete="off">
                    <ul id="lista-sugestoes-manual" class="search-results"></ul>
                </div>
                <div style="width: 40px; display:flex; align-items:flex-end;">
                    <button type="button" id="btnCadRapido" title="Cadastrar Novo Produto" style="height:42px; background:#f39c12; margin:0; padding:0; display:flex; justify-content:center; align-items:center;">
                        <span class="material-icons">add</span>
                    </button>
                </div>
              </div>
              <div style="flex: 1;">
                 <label style="font-size:12px;">C√≥digo</label>
                 <input type="text" id="input-item-codigo" placeholder="C√≥d">
              </div>
            </div>
            
            <div class="row" style="margin-top:10px; align-items:flex-end;">
               <div style="flex: 1;"><label style="font-size:12px;">Qtd</label><input type="number" id="input-item-qtd" placeholder="0"></div>
               <div style="flex: 1;"><label style="font-size:12px;">Pre√ßo Un. (R$)</label><input type="number" step="0.01" id="input-item-preco" placeholder="0,00"></div>
               <div style="flex: 0.8;">
                 <button type="button" id="btnAddItemNota" style="height:42px; background:#27ae60; margin-top:0;">+ Add</button>
               </div>
            </div>
          </div>

          <div class="table-container" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #ddd;">
            <table class="styled-table" style="font-size:13px;">
              <thead>
                <tr style="background:#eee; color:#333;">
                  <th>C√≥d</th><th>Produto</th><th>Qtd</th><th>Pre√ßo</th><th>Total</th><th></th>
                </tr>
              </thead>
              <tbody id="tabela-itens-nota-manual"></tbody>
            </table>
          </div>
          <div id="msg-sem-itens" style="text-align:center; color:#999; font-size:12px; margin-bottom:10px;">Nenhum item adicionado.</div>

          <div style="display:flex; justify-content:space-between; align-items:center; background:#f1f1f1; padding:10px; border-radius:5px; font-weight:bold;">
             <span>Total Itens: <span id="display-total-qtd">0</span></span>
             <span style="color:#27ae60; font-size:16px;">Total Nota: <span id="display-total-valor">R$ 0,00</span></span>
          </div>

          <button type="submit" class="btn-save" id="btn-salvar-nota" style="background-color: #e74c3c;">Salvar Nota Completa</button>
        </form>
      </div>
    </div>

    <div id="modal-lancamento-financeiro" class="modal" style="z-index: 200;">
      <div class="modal-content" style="border: 2px solid #27ae60;">
        <h3>Lan√ßar no Contas a Pagar?</h3>
        <p style="margin-bottom:15px; color:#555;">Deseja criar uma previs√£o de pagamento para esta nota?</p>
        
        <form id="form-financeiro-rapido">
           <input type="hidden" id="fin_fornecedor">
           <input type="hidden" id="fin_valor">
           <input type="hidden" id="fin_descricao">
           
           <div class="form-group">
             <label>Data de Vencimento</label>
             <input type="date" id="fin_data_vencimento" required>
           </div>
           
           <div class="row">
             <button type="button" class="btn-save half" style="background-color:#95a5a6;" id="btnCloseFinRapido">N√£o Lan√ßar</button>
             <button type="submit" class="btn-save half" style="background-color:#27ae60;">Sim, Lan√ßar</button>
           </div>
        </form>
      </div>
    </div>
    
    <div id="modal-nova-despesa" class="modal">
      <div class="modal-content" style="width: 450px; max-height: 90vh; overflow-y: auto;">
         <span class="close" id="closeNovaDespesa">&times;</span>
         <h3 style="text-align: center; margin-bottom: 20px;">Nova Movimenta√ß√£o</h3>
         
         <form id="form-financeiro-manual">
            <div class="type-toggle">
               <div class="type-option despesa selected" id="opt-despesa">DESPESA</div>
               <div class="type-option receita" id="opt-receita">RECEITA</div>
            </div>
            
            <div style="position: relative; margin-bottom: 15px;">
               <span style="position: absolute; left: 10px; top: 10px; font-size: 16px; color: #777;">R$</span>
               <input type="number" step="0.01" id="fin_man_valor" required class="value-display" placeholder="0,00" title="Valor Total">
            </div>

            <div class="form-group">
               <label>Descri√ß√£o</label>
               <input type="text" id="fin_man_descricao" required placeholder="Ex: Compra de Equipamento" style="background: #f9f9f9;">
            </div>
            <div class="form-group">
               <label>Fornecedor / Pagador</label>
               <input type="text" id="fin_man_fornecedor" placeholder="Ex: Dell, Sabesp, Cliente X" style="background: #f9f9f9;">
            </div>
            
            <div class="row">
               <div class="form-group half">
                  <label>Data Emiss√£o</label>
                  <input type="date" id="fin_man_emissao" required style="background: #f9f9f9;">
               </div>
               <div class="form-group half">
                  <label>Vencimento (1¬™ Parc)</label>
                  <input type="date" id="fin_man_vencimento" required style="background: #f9f9f9;">
               </div>
            </div>

            <div style="background: #f0f4f8; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
               <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                  <input type="checkbox" id="check_parcelado" style="width: auto;">
                  <label for="check_parcelado" style="margin: 0; font-weight: 600; font-size: 14px; cursor: pointer;">Pagamento Parcelado?</label>
               </div>
               
               <div id="area-parcelas" style="display: none;">
                  <div class="row" style="margin-bottom: 10px;">
                     <div class="form-group half">
                        <label>Qtd Parcelas</label>
                        <input type="number" id="fin_man_qtd_parc" value="2" min="2">
                     </div>
                     <div class="form-group half">
                         <label style="color:#777; font-size:11px; margin-top:25px;">(Altere as datas abaixo)</label>
                     </div>
                  </div>
                  <div id="container-parcelas-geradas"></div>
               </div>
            </div>

            <div class="form-group">
                  <label>Status</label>
                  <select id="fin_man_status" style="background: #f9f9f9;">
                     <option value="Pendente">Pendente</option>
                     <option value="Pago">Pago</option>
                     <option value="Recebido">Recebido</option>
                  </select>
            </div>
            
            <button type="submit" class="btn-save" id="btn-salvar-fin-manual" style="height: 50px; font-size: 16px; margin-top: 10px;">Salvar Lan√ßamento</button>
         </form>
      </div>
    </div>

    <div id="modal-importar-xml" class="modal">
      <div class="modal-content">
        <span class="close" id="closeImportarXML">&times;</span>
        <h3>Importar XML da Nota</h3>
        <p style="font-size:12px; color:#666; margin-bottom:15px;">Importar XML atualiza automaticamente o estoque.</p>
        <div style="border: 2px dashed #ccc; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 20px;">
           <input type="file" id="file-xml" accept=".xml" style="width: 100%;">
        </div>
        <button type="button" id="btn-processar-xml" class="btn-save" style="background-color: #f1c40f; color:#333; font-weight:600;">Processar Arquivo</button>
      </div>
    </div>

    <div id="modal-usuario" class="modal">
      <div class="modal-content">
        <span class="close" id="closeUsuario">&times;</span>
        <h3 id="titulo-modal-usuario">Novo Usu√°rio</h3>
        <form id="form-usuario">
          <input type="hidden" name="is_edit" id="usuario_is_edit" value="false">
          <input type="hidden" id="usuario_id_edit">
          <div class="form-group"><label>Nome</label><input type="text" id="user_nome" required></div>
          <div class="form-group"><label>Login</label><input type="text" id="user_login" required></div>
          <div class="form-group"><label>Senha</label><input type="password" id="user_senha" required></div>
          <div class="form-group"><label>Perfil</label>
            <select id="user_perfil"><option value="Colaborador">Colaborador</option><option value="Administrador">Administrador</option></select>
          </div>
          <button type="submit" class="btn-save" id="btn-salvar-usuario">Salvar</button>
        </form>
      </div>
    </div>

    <div id="modal-produto" class="modal">
      <div class="modal-content">
        <span class="close" id="closeProduto">&times;</span>
        <h3 id="titulo-modal-produto">Novo Produto</h3>
        <form id="form-produto">
          <input type="hidden" name="is_edit" id="is_edit" value="false">
          <input type="hidden" id="prod_id_edit">
          <div class="row">
            <div class="form-group half"><label>C√≥digo</label><input type="text" id="prod_codigo" required></div>
            <div class="form-group half"><label>Grupo</label>
              <select id="prod_grupo" required><option value="">Carregando...</option></select>
            </div>
          </div>
          <div class="form-group"><label>Produto</label><input type="text" id="prod_nome" required></div>
          <div class="row">
            <div class="form-group half"><label>Qtd</label><input type="number" id="prod_qtd" required></div>
            <div class="form-group half"><label>Pre√ßo (R$)</label><input type="number" step="0.01" id="prod_preco" required></div>
          </div>
          <button type="submit" class="btn-save" id="btn-salvar-prod">Salvar Produto</button>
        </form>
      </div>
    </div>

    <div id="modal-contagem" class="modal">
      <div class="modal-content" style="width: 700px; max-width: 95%;">
        <span class="close" id="closeContagem">&times;</span>
        <h3>Contagem de Estoque</h3>
        <div class="search-add-area" style="background:#f9f9f9; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #eee;">
          <label style="font-size:12px; font-weight:bold; color:#666;">PESQUISAR PRODUTO PARA ADICIONAR:</label>
          <div class="row" style="position:relative;">
            <div style="flex: 3; position:relative;">
              <input type="text" id="input-busca-contagem" placeholder="Digite nome ou c√≥digo..." autocomplete="off">
              <ul id="lista-sugestoes-contagem" class="search-results"></ul>
            </div>
            <div style="flex: 1;">
              <input type="number" id="input-qtd-contagem" placeholder="Qtd Real" disabled>
            </div>
            <button type="button" id="btn-add-contagem" style="width:auto; background:#27ae60;" disabled>
              <span class="material-icons">add</span>
            </button>
          </div>
        </div>
        <p style="font-size:13px; font-weight:bold; margin-bottom:5px;">Itens na Contagem:</p>
        <div class="lista-contagem-container">
          <table class="styled-table" style="font-size:13px;">
            <thead>
              <tr><th>Produto</th><th width="80px">Atual</th><th width="80px" style="background:#fff3cd; color:#856404;">Contada</th><th width="80px">Diferen√ßa</th><th width="40px"></th></tr>
            </thead>
            <tbody id="lista-contagem-corpo"></tbody>
          </table>
          <div id="msg-vazio-contagem" style="text-align:center; padding:20px; color:#999; font-size:12px;">Nenhum item adicionado ainda.</div>
        </div>
        <div class="form-group" style="margin-top:20px;">
          <label>Observa√ß√£o</label>
          <textarea id="obs-contagem" rows="2" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;" placeholder="Ex: Invent√°rio mensal..."></textarea>
        </div>
        <button id="btnSalvarContagem" class="btn-save" style="background-color: #f39c12;">Concluir Contagem</button>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app.js"></script>
</body>
</html>